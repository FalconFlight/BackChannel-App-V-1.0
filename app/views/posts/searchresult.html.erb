<% if @post_threads.length == 0 && @reply_threads.length == 0 %>
    <p>Sorry, no results found.</p>
<% end %>


<% if @post_threads.length > 0 %>


    <% if @search_type == "user" %>
        <p><%= "All Posts by #{@author.name.capitalize}" %></p><br/><br/>
    <% else %>
        <p><%= "All Posts containing searched string: \'#{@search_string}\'" %></p><br/><br/>
    <% end %>

    <% @post_threads.each do |p| %>

        <u><b><%="Post #{p.id}"%></b></u> <br />

        <%= p.content %><br />
        <b>Author</b>:  <%= User.find(p.user_id).name.capitalize %> <br />
        <b>Weight</b>:  <%= Post.find(p.id).weight %> <br />
        <b>Votes</b>: <%= Vote.find_all_by_post_id(p.id).count %> <br />

        <% if current_user.account_type != "guest" %>
            <%= link_to "Vote", newvote_path(:postid_from_page => p.id, :userid_from_page => current_user.id) %> |
            <%= link_to "Reply", newreply_path(:parentid => p.id) %> |
            <% if current_user.account_type == "admin" || current_user.id == p.user_id %>
                <%= link_to "Destroy", removepost_path(:post_id => p.id), :confirm => "Are you sure?" %>
            <% end %>
        <% end %>

        <br />
        <br /><b>REPLIES</b>:</br>
        <% Post.find_all_by_parent(p.id, :order => 'posts.created_at ASC').each do |reply| %>
            -------------------------------------<br />
            <b><%="ReplyID- #{reply.id}:"%></b>  |
            <% if current_user.account_type != "guest" %>
                <%= link_to "Vote", newvote_path(:postid_from_page => reply.id, :userid_from_page => current_user.id)%> |
                <% if current_user.account_type == "admin" || current_user.id == reply.user_id %>
                    <%= link_to "Destroy", removepost_path(:post_id => reply.id), :confirm => "Are you sure?" %>
                <% end %>
            <% end %>

            <br />
            <%= reply.content %><br />
            <b>Parent</b>:  <%= display_parent(reply) %> ,
            <b>Author</b>:  <%= User.find(reply.user_id).name %>,
            <b>Weight</b>:  <%= Post.find(reply.id).weight %> <br />
            <b>Votes</b>:   <%= Vote.find_all_by_post_id(reply.id).count %> <br />

            <br />
        <% end %>
        ================================================================
        <br />

    <% end %>
<% end %>

<% if @searched_from != "admin_console" %>

    <% if @reply_threads.length > 0 %>
        <% if @search_type == "user" %>
            <p><%= "All Threads including Replies by #{@author.name.capitalize}" %></p><br/><br/>
        <% else %>
            <p><%= "All Threads including Replies containing searched string: \'#{@search_string}\' " %></p><br/><br/>
        <% end %>


        <% @reply_threads.each do |post_number| %>

            <% if p = Post.find(post_number) %>
            <% end %>
            <u><b><%="Post #{p.id}"%></b></u> <br />

            <%= p.content %><br />
            <b>Author</b>:  <%= User.find(p.user_id).name.capitalize %> <br />
            <b>Weight</b>:  <%= Post.find(p.id).weight %> <br />
            <b>Votes</b>: <%= Vote.find_all_by_post_id(p.id).count %> <br />

            <% if current_user.account_type != "guest" %>
                <%= link_to "Vote", newvote_path(:postid_from_page => p.id, :userid_from_page => current_user.id) %> |
                <%= link_to "Reply", newreply_path(:parentid => p.id) %> |
                <% if current_user.account_type == "admin" || current_user.id == p.user_id %>
                    <%= link_to "Destroy", removepost_path(:post_id => p.id), :confirm => "Are you sure?" %>
                <% end %>
            <% end %>

            <br />
            <br /><b>REPLIES</b>:</br>
            <% Post.find_all_by_parent(p.id, :order => 'posts.created_at ASC').each do |reply| %>
                -------------------------------------<br />
                <b><%="ReplyID- #{reply.id}:"%></b>  |
                <% if current_user.account_type != "guest" %>
                    <%= link_to "Vote", newvote_path(:postid_from_page => reply.id, :userid_from_page => current_user.id)%> |
                    <% if current_user.account_type == "admin" || current_user.id == reply.user_id %>
                        <%= link_to "Destroy", removepost_path(:post_id => reply.id), :confirm => "Are you sure?" %>
                    <% end %>
                <% end %>

                <br />
                <%= reply.content %><br />
                <b>Parent</b>:  <%= display_parent(reply) %> ,
                <b>Author</b>:  <%= User.find(reply.user_id).name %>,
                <b>Weight</b>:  <%= Post.find(reply.id).weight %> <br />
                <b>Votes</b>:   <%= Vote.find_all_by_post_id(reply.id).count %> <br />

                <br />
            <% end %>
            ================================================================
            <br />

        <% end %>

    <% end %>
<% end %>

<br />
<br />

<%= link_to "Back to All Posts", posts_path %>
<% if @searched_from == "admin_console" %>
    | <%= link_to " Back to Manage Accounts", users_path %>
<% end %>